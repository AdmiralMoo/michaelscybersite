<style>
    body
    {
        background-color: black;
        font-family: Helvetica, sans-serif;
        margin: 0;
    }

    h1
    {
        font-family: Helvetica, sans-serif;
        font-size: 13px;
        margin-left: 4px;
        color: #000000;
          text-shadow:
            -0.5px -0.5px 0 rgb(255, 255, 255),
            0.5px -0.5px 0 rgb(255, 255, 255), 
            -0.5px 0.5px 0 rgb(255, 255, 255), 
            0.5px 0.5px 0 rgb(255, 255, 255);  
    }

    .iPodFrame
    {
        background-color: white;
        
        width: 100%;
        height: 100%;
        max-width: 320px;
        max-height: 240px;
    }

    .iPodHeader
    {
        background: #cccccc;
        background: linear-gradient(0deg,rgba(204, 204, 204, 1) 25%, rgba(255, 255, 255, 1) 75%);

        width: 100%;
        height: 19px;

        border-bottom: 1px solid #a4a4a4;

        display: flex;
        align-items: center;
        justify-content: space-between;

    }

    .iPodHeader-Icons
    {
        display: flex;
        flex-direction: row;
        width: 48px;
        height: 19px;

        align-items: center;
        justify-content: space-between;

        margin-right: 4px;
    }

    .iPodHeader-PlayPause
    {
        background-image: url('/assets/icons/iPod_Pause.svg');
        background-size: contain;
        background-repeat: no-repeat;

        width: 100%;
        height: 100%;
        max-width: 14px;
        max-height: 14px;
    }

    .iPodHeader-Battery
    {
        background-image: url('/assets/icons/iPod_Battery.svg');
        background-size: contain;
        background-repeat: no-repeat;

        max-width: 28px;
        max-height: 13px;
        width: 100%;
        height: 100%;
    }


    .iPodContent
    {
        display: flex;
        flex-direction: row;
        
        width: 100%;
        height: 188px;
    }

    .iPodContent-AlbumArt {
        padding-left: 6px;
        scale: 95%;
        width: 154px;
        height: 100%;
        display: flex;
        align-items: top;
        justify-content: center;
        padding-top: 10px;
        transform: perspective(600px) rotate3d(0, 1, 0, 20deg);
        overflow: clip;
    }

    .albumart-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow: clip;
    }

    .albumart-wrapper img {
        width: 148px;
        height: 134px;
        display: block;
    }

    .albumart-wrapper .reflection {
        transform: scaleY(-1);
        
        mask-image: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(255,0,0,0) 35%);
        mask-size: 100% 100%;
        mask-repeat: no-repeat;
        pointer-events: none;
    }
    
    .iPodContent-AlbumArt img
    {
        width: 148px;
        height: 134px;
            
        display: block;
    }

    /* iPod Footer Code */

    .iPodProgressBar-Back
    {
        display: block;
        position: relative;

        width: 209px;
        height: 10px;

        border-bottom: 0.7px solid #a4a4a4;
        border-top: 0.7px solid #dddddd;

        background: linear-gradient(180deg,rgba(247, 247, 247, 1) 0%, rgba(247, 247, 247, 1) 30%, rgba(235, 238, 237, 1) 45%, rgba(227, 232, 233, 1) 50%, rgba(232, 232, 232, 1) 65%, rgba(247, 247, 247, 1) 90%, rgba(235, 238, 237, 1) 100%);
        margin-bottom: 16px;
    }

    .iPodProgressBar-Fill
    {
        position: block;
        position: relative;

        top:-0.7px;

        width: 50%;
        height: 10px;      
        
        border-bottom: 0.7px solid #86aeff;
        border-top: 0.7px solid #7489ff;

        background: linear-gradient(180deg,rgba(136, 160, 223, 1) 0%, rgba(96, 141, 255, 1) 30%, rgba(100, 146, 255, 1) 45%, rgba(59, 139, 252, 1) 50%, rgba(58, 149, 251, 1) 65%, rgba(86, 187, 251, 1) 90%, rgba(130, 201, 247, 1) 100%);
        margin-bottom: 16px;
    }

    .iPodFooter
    {
        width: 100%;
        height: 32px;

        display: flex;
        justify-content: space-around;
        align-items: center;
        background-color: white;
    }

    .iPodText
    {
        font-size: 10px;
        font-weight: bold;
    }

    #timeCurrent
    {
        margin-left: 6px;
        margin-bottom: 16px;
    }

    #timeTotal
    {
        margin-right: 6px;
        margin-bottom: 16px;
    }

    /* Within the iPod's right display panel */

    .iPodContent-Body
    {
        width: 144px;
        padding-right: 23px;
        height: 100%;
    }

    .iPodDisplay-Icons
    {
        height: 32px;
        width: 144px;
    }

    .iPodDisplay-Song-Container {
        position: relative;
        max-width: 144px;
        overflow: hidden;
        height: 22px;
    }

    .iPodDisplay-Song {
        font-family: Helvetica, Arial, sans-serif;
        font-weight: bold;
        font-size: 15px;
        white-space: nowrap;
        display: inline-block;
        position: absolute;
        left: 0;
        top: 0;
    }

    .iPodDisplay-Song-Container::after {
        position:absolute;
        content: '';
        top:0;
        right:0;
        width:15%;
        height:100%;
        background: linear-gradient(-90deg,rgba(255, 255, 255, 1) 25%, rgba(255, 255, 255, 0) 100%);
    }

    .iPodDisplay-Artist
    {
        font-family: Helvetica, sans-serif;
        font-weight: bold;
        font-size: 12px;
        color: #636363;

        max-width: 144px;
        text-overflow: ellipsis;
        white-space: nowrap;

        overflow:hidden;

        padding-top: 8px;
    }

    .iPodDisplay-Album
    {
        font-family: Helvetica, sans-serif;
        font-weight: bold;
        font-size: 12px;
        color: #636363;
        
        max-width: 144px;
        text-overflow: ellipsis;
        white-space: nowrap;

        overflow:hidden;

        padding-top: 2px;
    }

    .iPodDisplay-Stars
    {
        font-family: Helvetica, sans-serif;
        font-weight: normal;
        font-size: 12px;
        color: #636363;

        overflow:hidden;

        padding-top: 2px;
    }

    .iPodDisplay-Count
    {
        font-family: Helvetica, sans-serif;
        font-weight: bold;
        font-size: 11px;
        color: #636363;

        overflow:hidden;

        padding-top: 4px;
    }
</style>

<body>
    <div class="iPodFrame">
        <div class="iPodHeader">
            <h1>Now Playing</h1>
            <div class="iPodHeader-Icons">
                <div class="iPodHeader-PlayPause"><img href=""></div>
                <div class="iPodHeader-Battery"><img href=""></div>
            </div>
        </div>
        <div class="iPodContent">
            <div class="iPodContent-AlbumArt">
                <div class="albumart-wrapper">
                    <img id="arttop" src="/assets/albumart/pink floyd - the dark side of the moon.jpg" alt="Album Art">
                    <img id="artbot"src="/assets/albumart/pink floyd - the dark side of the moon.jpg" alt="" aria-hidden="true" class="reflection">
                </div>
            </div>
            <div class="iPodContent-Body">
                <div class="iPodDisplay-Icons"></div>
                <div class="iPodDisplay-Song-Container">
                    <div class="iPodDisplay-Song" id="song-title">
                        Speak To Me / Breathe In The Air
                    </div>
                </div>
                <div class="iPodDisplay-Artist">Pink Floyd</div>
                <div class="iPodDisplay-Album">The Dark Side of The Moon</div>
                <div class="iPodDisplay-Stars">★★★★★</div>
                <div class="iPodDisplay-Count">1 of 365</div>
            </div>
        </div>
        <div class="iPodFooter">
            <span class="iPodText" id="timeCurrent">1:31</span>
            <div class="iPodProgressBar-Back">
                <div class="iPodProgressBar-Fill"></div>
            </div>
            <span class="iPodText" id="timeTotal">-2:29</span>
        </div>
    </div>
    <script>
    window.addEventListener('DOMContentLoaded', () => {
        const song = document.getElementById('song-title');
        const container = song.parentElement;
        let songsAmount = 0;
        let songIndex = 0;

        window.playRandomSong = function()
        {
            fetch("/assets/json/songShowcaseData.json")
            .then(resp => resp.json())
            .then(songList => {
                songIndex = Math.floor(Math.random() * songList.length);
                const randomSong = songList[songIndex];
                songsAmount = songList.length;
                this.window.updateSongData(randomSong);
            });
        }

        window.updateSongData = function(songData) {
            document.getElementById('song-title').textContent = songData.name;
            document.getElementById('arttop').src = songData.art;
            document.getElementById('artbot').src = songData.art;
            document.querySelector('.iPodDisplay-Artist').textContent = songData.artist;
            document.querySelector('.iPodDisplay-Album').textContent = songData.album;
            document.querySelector('.iPodDisplay-Count').textContent = `${songIndex} of ${songsAmount}`;
            document.querySelector('#timeTotal').textContent = `-${songData.duration}`;
            document.querySelector('#timeCurrent').textContent = `0:00`;

            let totalSeconds = 0;
            if (songData.duration) {
                const parts = songData.duration.split(':');
                totalSeconds = parseInt(parts[0], 10) * 60 + parseInt(parts[1], 10);
            }

            if (totalSeconds > 0) {
                startProgressBar(totalSeconds);
            }

            animateBounce();
        };

        function animateBounce() {
            const song = document.getElementById('song-title');
            const shouldScroll = song.textContent.trim().length > 16;
            console.log(song.textContent.trim().length)

            // Reset animation
            song.style.transition = '';
            song.style.transform = 'translateX(0)';

            if (shouldScroll) {
                // Your animation code here
                const container = song.parentElement;
                const distance = song.scrollWidth - container.clientWidth + 16;
                let atStart = true;
                function bounce() {
                    song.style.transition = 'transform 4s linear';
                    song.style.transform = atStart
                        ? `translateX(-${distance}px)`
                        : 'translateX(0)';
                    atStart = !atStart;
                    setTimeout(bounce, 4800);
                }
                setTimeout(bounce, 1000);
            }
        }


        function updateProgressBar(currentSeconds, totalSeconds) {
            const fill = document.querySelector('.iPodProgressBar-Fill');
            const timeCurrent = document.getElementById('timeCurrent');
            const timeTotal = document.getElementById('timeTotal');

            let percent = (currentSeconds / totalSeconds) * 100;
            percent = Math.max(0, Math.min(100, percent)); 

            fill.style.width = percent + '%';

            function fmt(s) {
                const m = Math.floor(s / 60);
                const sec = Math.floor(s % 60);
                return m + ':' + (sec < 10 ? '0' : '') + sec;
            }

            timeCurrent.textContent = fmt(currentSeconds);
            timeTotal.textContent = '-' + fmt(totalSeconds - currentSeconds);

            if (percent >= 99.5)
            {
                this.playRandomSong();
            }
        }

        function startProgressBar(totalSeconds) {
            let currentSeconds = 0;

            if (window.progressInterval) clearInterval(window.progressInterval);

            updateProgressBar(0, totalSeconds);

            window.progressInterval = setInterval(() => {
                currentSeconds++;
                if (currentSeconds > totalSeconds) {
                    clearInterval(window.progressInterval);
                    currentSeconds = totalSeconds;
                }
                updateProgressBar(currentSeconds, totalSeconds);
            }, 1000);
        }

        window.addEventListener('resize', animateBounce);
    });
</script>
</body>