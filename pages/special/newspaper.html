<style>
    /* Formatting Gubbins */
    sup 
    {
        line-height: 0;
        font-size: 0.83em;
        vertical-align: super;
    }

    .bw
    {
        filter: saturate(0.0);
    }

    .space-between
    {
        display: flex;
        justify-content: space-between;
    }

    /* Styles for Hyperlinks */
    .hyperlink, .hyperlink:visited
    {
        font-size: 0.9em;
        font-style: italic;
        font-weight: bold;
        color: blue;
        text-decoration: underline;
        cursor: pointer;
    }

    .hyperlink:hover
    {
        color: rgb(75, 75, 255);
    }

    .hyperlink:active
    {
        color: rgb(255, 0, 255);
    }

    /* Body & Container Formatting */
    body
    {
        width: 1200px;
        z-index:2;
    }

    .newspaper-container
    {
        background-color: lightgray;
    
        padding: 6px;

        /*mask: repeating-conic-gradient(from 135deg at 50% 5px,#0000 0,#000 1deg 89deg,#0000 90deg 180deg) 50% -5px/10px;*/
    }

    /* Newspaper Banner Styles */
    #newspaper-name
    {
        width: 100%;
        object-fit: scale-down;
        align-items: center;

        padding-top: 0px;
        padding-bottom: 2px;
    }

    .newspaper-header
    {
        width: 100%;
    }

    .newspaper-header-bar
    {
        width: 100%;
        display: grid; 
        grid-template-columns: 1fr 1fr 1fr;

        border-bottom: 6px black double; 
    }

    .newspaper-header-bar p
    {
        margin:0px; 
        padding:4px; 
        font-family: 'EB Garamond', serif; 
        font-weight:bold;
        text-align: center;
        place-items: end center;
    }

    #newspaper-header-slogan
    {
        margin:0; 
        padding:0; 
        align-self: center; 
        font-family: 'EB Garamond', serif; 
        font-size: 0.85em;
        font-weight:bold; 
        transform:scaleX(1.3);
        text-align: center;
        width: 100%;

        padding-bottom: 8px;
    }

    /* Newspaper Grid Positioning */
    .news-layout
    {
        display: grid;
        grid-template-columns: 1fr 1fr 240px;
        grid-template-rows: auto auto auto;
        border: 1px solid black;

        grid-template-areas:
            "main       main        sidebar"
            "top-left   top-right   sidebar"
            "bot-left   bot-right   bot-corner"
            "cs         cs          cs";
    }

    .story-one  { grid-area: top-left;  }
    .story-two  { grid-area: top-right; }
    .main       { grid-area: main;      }
    .bot-left   { grid-area: bot-left;  }
    .bot-right  { grid-area: bot-right; }
    .bot-corner { grid-area: bot-corner; }
    .sidebar    { grid-area: sidebar;   }

    /* Classifieds Formatting */
    .classifieds-container 
    { 
        grid-area: cs;
        border-top: 1px black solid;
        padding: 4px;

        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .classifieds-body
    {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr 1fr;

        gap: 1px;
        padding: 2px;
    }

    #cs2,#cs3,#cs4,#cs5
    {
        padding-left: 6px;
        box-sizing: border-box;
        border-left: 1px black solid;
    }

    #classifieds-header
    {
        width: 100%;
        font-weight: bold;
        font-size: 1.2em;
        text-align: center;
    }

    /* Story Formatting */
    .story-container
    {
        padding: 4px;
        margin: 4px;
    }

    .story-headline
    {
        font-size: 1.6em;
        font-weight: bold;
    }

    .story-body
    {
        margin-top: 2px;
    }
    
    .story-body p
    {
        margin-top:0px;
        padding-left: 4px;
        padding-right: 4px;
        padding-bottom: 4px;
    }

    .story-image
    {
        float: left;
        padding-right: 8px;
        max-width: 50%;
        z-index: 1;
    }

    .story-image img
    {
        object-fit: scale-down;
        width: 100%;
    }

    /* Story-specific formatting */
    .story-one .story-image, .story-two .story-image
    {
        filter: saturate(0.0);
        z-index: 1;
    }

    .story-one .story-headline, .story-two .story-headline
    {
        font-size: 1.3em;
        letter-spacing: -0.5px;
    }

    .main
    {
        border-bottom: 1px solid black;  
        padding-bottom: 8px;
    }

    .story-one
    {
        border-bottom: 1px solid black;
    }

    .story-two
    {
        border-left: 1px solid black;
        padding-left: 12px;
    }

    .bot-left
    {
        display: grid;
        grid-template-columns: 1fr 1fr;
    }

    .story-three-a, .story-three-b
    {
        padding: 4px;
        margin: 4px;

        font-size: 0.8em;
    }

    .story-three-b
    {
        border-left: 1px solid black;
        padding-left: 12px;
    }

    .bot-left .story-headline
    {
        font-size: 1.1em;
    }

    .sidebar
    {
        border-left: 1px solid black;
        padding-left: 12px;
    }

    /* News Popups For Crap-Cut-Truncated-Things */
    .news-popup::after
    {
        content: "";
        visibility: hidden;
    }

    #modal-one, #modal-two, #modal-three, #modal-four, #modal-five, #modal-six, #modal-seven {
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        max-width: 100%;
        width: 100%;
        background-color: rgba(0,0,0,.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2;
    }

    #modal-one:not(:target), #modal-two:not(:target), #modal-three:not(:target), #modal-four:not(:target), #modal-five:not(:target), #modal-six:not(:target), #modal-seven:not(:target)
    {
        visibility: hidden;
        opacity: 0;
    }

    .modal__window 
    {
        position: relative; 
        background-color: rgb(240,240,240);
        max-width: 512px;
        padding: 4em 2em;

        box-shadow: 12px 12px rgb(0, 0, 0), 24px 24px rgba(0, 0, 0, 0.75), 36px 36px rgba(0, 0, 0, 0.5), 48px 48px rgba(0, 0, 0, 0.25);
    }

    .modal__close 
    {
        position: absolute;
        top: 0;
        right: 0;

        width: 32px;
        height: 32px;
        background-color: rgb(202, 23, 23);

        display: flex;
        align-items: center;
        justify-content: center;
        text-justify: center;

        color: black;
        font-weight: bold;
        font-family: sans-serif;
        text-decoration: none;
    }

    /* Newspaper Banner Sizing */
    @media(max-width: 400px)
    {

    }
</style>


<body>
    <div class="newspaper-container">
        <div class="newspaper-header">
            <img id="newspaper-name" src="assets\site\sitebanner_gazette_1.png" style="max-height:50px;">
            <p id="newspaper-header-slogan">– FACT, CONJECTURE, AND EVERYTHING IN BETWEEN –</p>
            <span class="newspaper-header-bar">
                <p style="text-align: left;" id="newspaper-date">GOOD AFTERNOON–TODAY IS MARCH 10TH</p>
                <p id="newspaper-greeting">GOOD AFTERNOON–TODAY IS MARCH 10TH</p>
                <p style="text-align: right;" id="newspaper-price">$4.50</p>
            </span>
        </div>
        <div class="newspaper-body">
            <div class="news-layout">
                <div class="story-container main"></div>
                <div class="story-container story-one"></div>
                <div class="story-container story-two"></div>
                <div class="bot-left">
                    <div class="story-container story-three-a"></div>
                    <div class="story-container story-three-b"></div>
                </div>
                <div class="bot-right"></div>
                <div class="story-container sidebar">
                    <div class="story-header">
                        <p class="story-headline" style="width:100%; text-align: center; padding-top:0px; margin-top:0px; margin-bottom: -3px;">MIXED NUTS</p>
                        <hr style="width:95%"> 
                        <p class="story-headline" style="
                            width:100%; 
                            text-align: center; 
                            padding-top:0px; 
                            padding-bottom:3px; 
                            margin-top:-3px; 
                            margin-bottom: 0px; 
                            letter-spacing: -0.5px; 
                            font-size: 0.9em;
                            border-bottom: 3px double black;
                            ">Quality Reporting From Your Backyard & Beyond
                        </p>
                    </div>
                </div>
                <div class="classifieds-container">
                    <div id="classifieds-header">CLASSIFIEDS</div>
                    <hr style="margin: 0px; padding: 1px; width: 5%;"></hr>
                    <div class="classifieds-body">
                        <div id="cs1"></div>
                        <div id="cs2"></div>
                        <div id="cs3"></div>
                        <div id="cs4"></div>
                        <div id="cs5"></div>
                    </div>
                </div>
                <div class="story-container bot-corner"></div>
            </div>
        </div>
    </div>
</body>

<script>
    window.onload = function() 
    {
        UpdateNewsTitle();
        UpdateSiteClassifieds();
        InsertNewsStory("main", 0, true, true, 200, "read the full story...");
        InsertNewsStory("story-one", 1, true, true, 45, "read the full story...");
        InsertNewsStory("story-two", 2, true, true, 45, "read the full story...");
        InsertNewsStory("story-three-a", 3, false, false, 0, "read...");
        InsertNewsStory("story-three-b", 4, false, false, 0, "read...");
        InsertFakeStory("sidebar", 6);

        initBlogposts();
    }

    async function initBlogposts() 
    {
        const story = await retrieveArticle("Never Forget What They Took From Us");

        InsertNewsStory("bot-right", 666, true, false, 45, "read blogpost...", story);
    }

    /*News Titles*/
    function UpdateNewsTitle() 
    {
        //Set the newspaper name:
        const newspaperBanner = document.getElementById("newspaper-name");
        newspaperBanner.src = "/assets/site/sitebanner_gazette_" + Math.floor(Math.random() * 10 + 1) + ".png";
        
        //Define greeting based on the time of day
        const date = new Date();
        let greeting = '';
        let datemsg = '';
        const hour = date.getHours();

        if (hour >= 5 && hour < 12) {
            greeting = 'GOOD MORNING';
        } else if (hour >= 12 && hour < 17) {
            greeting = 'GOOD AFTERNOON';
        } else if (hour >= 17 && hour < 21) {
            greeting = 'GOOD EVENING';
        } else {
            greeting = 'GO TO BED';
        }

        document.getElementById('newspaper-greeting').innerHTML = `${greeting}`;

        //Get the date and format it
        const options = { month: 'long', day: 'numeric' };
        let formattedDate = date.toLocaleDateString('en-US', options); 
        formattedDate = formattedDate.toUpperCase();

        if (formattedDate.slice(-1) == 1)
        {
            formattedDate += "<sup>st</sup>";
        } else if (formattedDate.slice(-1) == 2)
        {
            formattedDate += "<sup>nd</sup>";
        } else if (formattedDate.slice(-1) == 3)
        {
            formattedDate += "<sup>rd</sup>";
        } else
        {
            formattedDate += "<sup>th</sup>";
        }

        document.getElementById('newspaper-date').innerHTML = `${formattedDate}, ${date.getFullYear()}`;

        //Set a price
        let price = Math.floor(Math.random() * 683 + 25) / 100;
        document.getElementById('newspaper-price').innerHTML = `$${price}`;
    };

    /*Classifieds*/
    function UpdateSiteClassifieds()
    {
        fetch('/assets/json/newspapermessages.json')
        .then(response => response.json())
        .then(data => {
            const classifieds = data.classifieds;
            const randomMessageOne = classifieds[Math.floor(Math.random() * classifieds.length)];
            const randomMessageTwo = classifieds[Math.floor(Math.random() * classifieds.length)];
            const randomMessageThree = classifieds[Math.floor(Math.random() * classifieds.length)];
            const randomMessageFour = classifieds[Math.floor(Math.random() * classifieds.length)];
            const randomMessageFive = classifieds[Math.floor(Math.random() * classifieds.length)];

            document.querySelector('#cs1').innerHTML = `${formatClassified(randomMessageOne)}`;
            document.querySelector('#cs2').innerHTML = `${formatClassified(randomMessageTwo)}`;
            document.querySelector('#cs3').innerHTML = `${formatClassified(randomMessageThree)}`;
            document.querySelector('#cs4').innerHTML = `${formatClassified(randomMessageFour)}`;
            document.querySelector('#cs5').innerHTML = `${formatClassified(randomMessageFive)}`;
        })
        .catch(error => console.error('Error fetching footer messages:', error));
    }

    function formatClassified(msg) 
    {
        const parts = msg.split(":");
        if (parts.length > 1) {
            return `<b>${parts[0]}:</b>${parts.slice(1).join(":")}`;
        }
        return msg;
    }

    /* Fake Stories*/
    function InsertFakeStory(slotID, quantity)
    {
        fetch('/assets/json/newspapermessages.json')
        .then(response => response.json())
        .then(data => {
            const messages = data.messages;
            let content = '';

            for (let i = 0; i < quantity; i++)
            {   
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];

                let randomNumber = 1 + Math.floor(Math.random() * 30);
                let result = `<p><i><b>${randomMessage}</b></i>—Page ${randomNumber}</p>`;

                content += result;
            }

            document.getElementsByClassName(slotID)[0].innerHTML += content;
        })
        .catch(error => console.error('Error fetching footer messages:', error));
    }

    /*News Stories*/
    function InsertNewsStory(slotID, storyIndex, showImage, showByline, truncateWords, truncatePrompt, storyData)
    {
        const newspaperBodyArea = document.getElementsByClassName(slotID)[0];
        newspaperBodyArea.innerHTML = "";
        let htmlContent = '';
        let byline = ''
        let indexString = '';
        let truncate = true;
        let blogpost = false;
        if (storyIndex == 0) { indexString = "one"; }
        if (storyIndex == 1) { indexString = "two"; }
        if (storyIndex == 2) { indexString = "three"; }
        if (storyIndex == 3) { indexString = "four"; }
        if (storyIndex == 4) { indexString = "five"; }
        if (storyIndex == 5) { indexString = "six"; }
        if (storyIndex == 6) { indexString = "seven"; }

        /* Get the byline */
        fetch('/assets/json/newspapermessages.json')
            .then(response => response.json())
            .then(data => 
            {
                const bylines = data.bylines;
                const authors = data.newsauthors;

                const prefix = bylines[Math.floor(Math.random() * bylines.length)];
                const author = authors[Math.floor(Math.random() * authors.length)];
                byline = prefix + author;
            }
        );

        /* Get the story */
        fetch('/assets/json/newspaperStories.json')
            .then(response => response.json())
            .then(data => 
            {
                if (storyIndex == 666 && storyData != null)
                {
                    story = storyData;
                    bodyText = story.body;
                    blogpost = true;
                    if (story.date == undefined)
                    {
                        story.date = "";
                    }
                }
                else
                {
                    story = data[storyIndex];
                    bodyText = story.body;
                }
                let modalID = `modal-${indexString}`;

                /* "Cut the crap" as The Clash say 
                 * -Check to see if we even need to truncate in the first place
                */
                if (truncate)
                {
                    if (story.body.split(" ").length < truncateWords)
                    {
                        truncate = false;
                    }
                    else
                    {
                        bodyText = bodyText.split(" ").splice(0,truncateWords).join(" ");
                        bodyText += "...";
                    }
                }

                /* Build content */
                htmlContent += `
                    <div class="story-header">
                        <span class="story-headline">${story.headline}</span>
                        <div class="space-between">
                `;

                if (showByline)
                {
                    htmlContent += `
                            <span style="font-style: italic;">${byline}</span>
                    `;
                }

                let linkInserted = false;
                if (truncate && !showByline && storyData == null)
                {
                    htmlContent += `
                        <span>${story.date}</span>
                        <br><a class="hyperlink" style="text-align: end; width: 35%; float: right;" href="\#${modalID}">${truncatePrompt}</a>
                    `;

                    linkInserted = true;
                }
                else
                {
                    htmlContent += `
                        <span>${story.date}</span>
                    `;
                }

                htmlContent += `
                        </div>
                    </div>
                    <div class="story-body">
                `;

                /* If we want an image thumbnail */
                if (showImage)
                {
                    htmlContent += `
                        <div class="story-image">
                            <img src="${story.image}">
                        </div>
                        <p>${bodyText}
                    `;
                }

                if (truncate || !linkInserted)
                {
                    let oldModalID = modalID;
                    if (blogpost)
                    {
                        modalID = storyData.link;
                    }
                    else 
                    {
                        modalID = "\#" + modalID;
                    }
                    htmlContent += `
                        <br><a class="hyperlink" style="text-align: end; width: 35%; float: right;" href="${modalID}">${truncatePrompt}</a>
                    `;

                    modalID = oldModalID;
                }

                htmlContent += `
                        </p>
                    </div>
                `;

                if (truncate)
                {
                    htmlContent += `
                        <div id="${modalID}">
                            <div class="modal__window">
                                <a class="modal__close" href="#">X</a>
                                <h2>${story.headline}</h2>
                                <div class="space-between">
                                    <span style="font-style: italic;">${byline}</span>
                                    <span>${story.date}</span>
                                </div>
                                <hr style="width: 97%;">
                                <div style="width:100%; height: auto;">
                                    <img class="bw" style="object-fit: fill; width: 100%;" src="${story.image}">
                                </div>
                                <p>${story.body}</p> 
                            </div>
                        </div>
                    `;
                }

                newspaperBodyArea.innerHTML = htmlContent;
            }
        );
    }

    function retrieveArticle(articleName)
    { 
        return fetch('/assets/json/articlesDatabase.json')
        .then(response => response.json())
        .then(data => 
            {
                let filteredArticle;
                filteredArticle = data.find(article => articleName.includes(article.name));

                const { category, name, description, image, link } = filteredArticle;

                console.log(name);
                console.log(description);

                return {
                    headline: name,
                    body: description,
                    image: image,
                    link: link
                };
            }
        )
        .catch(error => console.error('The JSON loader shit itself:', error));
    }
</script>